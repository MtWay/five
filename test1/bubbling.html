<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<style type="text/css">
			body {
    margin: 0;
    padding: 10px 0;
}
#canvas {
    height: 200px;
    width: 500px;
    margin: 0 auto;
}
#canvas div {
    display: inline-block;
    background-color: red;
    margin: 0;
    padding: 0;
}
		</style>
		<script src="js/jquery-2.1.0.js" type="text/javascript" charset="utf-8"></script>
	</head>
	<body>
		<div id="canvas">
			
		</div>
		<script type="text/javascript">
		
//		function qsort_with_loop(arr) {
//			//var divs = $("#canvas div");
//var stack = [];
//
//stack.push([0, arr.length - 1]);
//
//while (stack.length) {
//  let _ = stack.pop();
//  let i = l = _[0];
//  let j = r = _[1];
//  let mid = arr[(i + j) >> 1];
//
//  do {
//    while (arr[i] < mid) ++i;
//    while (arr[j] > mid) --j;
//    if (i <= j) {
//      let t = arr[i];
//      arr[i] = arr[j];
//      arr[j] = t;
//[divs[i].style.height,divs[j].style.height]=[divs[j].style.height,divs[i].style.height]
//      ++i;
//      --j;
//    }
//  } while (i <= j);
//
//  if (i < r) stack.push([i, r]);
//  if (l < j) stack.push([l, j]);
//}
//return arr;
//clearInterval(timer);
//
//}
		
		function quickSort(arr){
            //如果数组<=1,则直接返回
            if(arr.length<=1){return arr;}
            //var pivotIndex=Math.floor(arr.length/2);
            //找基准，并把基准从原数组删除
            var pivot=arr.splice(0,1)[0];
            //定义左右数组
            var left=[];
            var right=[];

            //比基准小的放在left，比基准大的放在right
            for(var i=0;i<arr.length;i++){
                if(arr[i]<=pivot){
                    left.push(arr[i]);
                }
                else{
                    right.push(arr[i]);
                }
            }
            //递归
            return quickSort(left).concat([pivot],quickSort(right));
        }
			var obj={
				n:1000,
			},w=100/obj.n,arr=[],data=[];
			for(let i = 0;i<obj.n;i++){
				arr.push(i);
			}
			
			for(let i=0;i<obj.n;i++){
				let r = parseInt(Math.random()*arr.length);
				data.push(arr[r])
				//console.log(arr[r])
				let $div = $("<div></div>");
				$div.css({width:(w+"%"),height:(arr[r]*w+"%")});
				arr.splice(r,1)
				$("#canvas").append($div);
			}
			console.log(data)
			//data = qsort_with_loop(data)
			arr =data
			console.log(data)
			var divs = $("#canvas div"),a=0,b=obj.n-1; 
			function don(){
				if(a==b){
					b--;
					a=0;
				}
				if(b==0){
					clearInterval(timer);
					return;
				}
//				if(divs[a].offsetHeight > divs[a+1].offsetHeight){	
				if(divs.eq(a).height() > divs.eq(a+1).height()){
					[divs[a].style.height,divs[a+1].style.height]=[divs[a+1].style.height,divs[a].style.height]
				}else{
					a++;
					don();
				}
				}
			var stack = [];
stack.push([0, arr.length - 1]);

			var timer =setInterval(function(){
				console.log(1)
//				if(a==b){
//					b--;
//					a=0;
//				}
//				don()
//				a++;
				//qsort_with_loop()
				if(stack.length) {
    let _ = stack.pop();
    let i = l = _[0];
    let j = r = _[1];
    let mid = arr[(i + j) >> 1];

    do {
      while (arr[i] < mid) ++i;
      while (arr[j] > mid) --j;
      if (i <= j) {
        let t = arr[i];
        arr[i] = arr[j];
        arr[j] = t;
  [divs[i].style.height,divs[j].style.height]=[divs[j].style.height,divs[i].style.height]
        ++i;
        --j;
      }
    } while (i <= j);

    if (i < r) stack.push([i, r]);
    if (l < j) stack.push([l, j]);
  }
				else{clearInterval(timer);}
			},10)
		</script>
	</body>
</html>
